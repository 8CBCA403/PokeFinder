version: 1.0.0.{build}

environment:
  QTDIR: C:\Qt\5.9.1
  BOOST_ROOT: C:\Libraries\boost_1_64_0
  MINGW_DIR: C:\Qt\5.9.1\mingw53_32
  matrix:
  - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2017
    SHORT_MSVC_PLATFORM: x64

configuration:
    - Release

init:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat"

install:
    - set PATH=%QTDIR%\bin;%MINGW_DIR%\bin;%PATH%

build_script:
    - qmake PokeFinder.pro
    - mingw32-make

after_build:
    - 7z a PokeFinder-windows.zip .\release\PokeFinder.exe
    - 7z a PokeFinder-windows.zip C:\QT\5.9.1\mingw53_32\bin\libwinpthread-1.dll
    - 7z a PokeFinder-windows.zip C:\QT\5.9.1\mingw53_32\bin\libstdc++-6.dll
    - 7z a PokeFinder-windows.zip C:\QT\5.9.1\mingw53_32\bin\libgcc_s_dw2-1.dll
    - 7z a PokeFinder-windows.zip C:\QT\5.9.1\mingw53_32\bin\Qt5Core.dll
    - 7z a PokeFinder-windows.zip C:\QT\5.9.1\mingw53_32\bin\Qt5Gui.dll
    - 7z a PokeFinder-windows.zip C:\QT\5.9.1\mingw53_32\bin\Qt5Widgets.dll
    - 7z a PokeFinder-windows.zip C:\QT\5.9.1\mingw53_32\plugins\platforms\qwindows.dll
    - 7z rn PokeFinder-windows.zip qwindows.dll platforms\qwindows.dll
    - 7z a PokeFinder-windows.7z .\release\PokeFinder.exe
    - 7z a PokeFinder-windows.7z C:\QT\5.9.1\mingw53_32\bin\libwinpthread-1.dll
    - 7z a PokeFinder-windows.7z C:\QT\5.9.1\mingw53_32\bin\libstdc++-6.dll
    - 7z a PokeFinder-windows.7z C:\QT\5.9.1\mingw53_32\bin\libgcc_s_dw2-1.dll
    - 7z a PokeFinder-windows.7z C:\QT\5.9.1\mingw53_32\bin\Qt5Core.dll
    - 7z a PokeFinder-windows.7z C:\QT\5.9.1\mingw53_32\bin\Qt5Gui.dll
    - 7z a PokeFinder-windows.7z C:\QT\5.9.1\mingw53_32\bin\Qt5Widgets.dll
    - 7z a PokeFinder-windows.7z C:\QT\5.9.1\mingw53_32\plugins\platforms\qwindows.dll
    - 7z rn PokeFinder-windows.7z qwindows.dll platforms\qwindows.dll

artifacts:
    - path: PokeFinder-windows.zip
    - path: PokeFinder-windows.7z

deploy:
    provider: GitHub
    description: ''
    auth_token:
        secure: f1bnm7cWsq0pNja+DdwEkQLCMUxczFH5O8eWDEnfNnhbHKuotQ7YFS6jLYyqFbGe
    artifact: PokeFinder-windows.zip,PokeFinder-windows.7z
    draft: false
    prerelease: true
    on:
        branch: master
        appveyor_repo_tag: true
